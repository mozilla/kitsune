

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Parallel examples &mdash; IPython 0.11 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="IPython 0.11 documentation" href="../index.html" />
    <link rel="up" title="Using IPython for parallel computing" href="index.html" />
    <link rel="next" title="DAG Dependencies" href="dag_dependencies.html" />
    <link rel="prev" title="Getting started with Windows HPC Server 2008" href="parallel_winhpc.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../_static/logo.png" border="0" alt="IPython Documentation"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dag_dependencies.html" title="DAG Dependencies"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parallel_winhpc.html" title="Getting started with Windows HPC Server 2008"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
       <li><a href="../index.html">documentation </a> &raquo;</li>

          <li><a href="index.html" accesskey="U">Using IPython for parallel computing</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Parallel examples</a><ul>
<li><a class="reference internal" href="#million-digits-of-pi">150 million digits of pi</a><ul>
<li><a class="reference internal" href="#serial-calculation">Serial calculation</a></li>
<li><a class="reference internal" href="#parallel-calculation">Parallel calculation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parallel-options-pricing">Parallel options pricing</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="parallel_winhpc.html"
                        title="previous chapter">Getting started with Windows HPC Server 2008</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dag_dependencies.html"
                        title="next chapter">DAG Dependencies</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/parallel/parallel_demos.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="parallel-examples">
<h1>Parallel examples<a class="headerlink" href="#parallel-examples" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Performance numbers from <tt class="docutils literal"><span class="pre">IPython.kernel</span></tt>, not newparallel.</p>
</div>
<p>In this section we describe two more involved examples of using an IPython
cluster to perform a parallel computation. In these examples, we will be using
IPython&#8217;s &#8220;pylab&#8221; mode, which enables interactive plotting using the
Matplotlib package. IPython can be started in this mode by typing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ipython</span> <span class="o">--</span><span class="n">pylab</span>
</pre></div>
</div>
<p>at the system command line.</p>
<div class="section" id="million-digits-of-pi">
<h2>150 million digits of pi<a class="headerlink" href="#million-digits-of-pi" title="Permalink to this headline">¶</a></h2>
<p>In this example we would like to study the distribution of digits in the
number pi (in base 10). While it is not known if pi is a normal number (a
number is normal in base 10 if 0-9 occur with equal likelihood) numerical
investigations suggest that it is. We will begin with a serial calculation on
10,000 digits of pi and then perform a parallel calculation involving 150
million digits.</p>
<p>In both the serial and parallel calculation we will be using functions defined
in the <tt class="file docutils literal"><span class="pre">pidigits.py</span></tt> file, which is available in the
<tt class="file docutils literal"><span class="pre">docs/examples/newparallel</span></tt> directory of the IPython source distribution.
These functions provide basic facilities for working with the digits of pi and
can be loaded into IPython by putting <tt class="file docutils literal"><span class="pre">pidigits.py</span></tt> in your current
working directory and then doing:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="n">run</span> <span class="n">pidigits</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="section" id="serial-calculation">
<h3>Serial calculation<a class="headerlink" href="#serial-calculation" title="Permalink to this headline">¶</a></h3>
<p>For the serial calculation, we will use <a class="reference external" href="http://www.sympy.org">SymPy</a> to
calculate 10,000 digits of pi and then look at the frequencies of the digits
0-9. Out of 10,000 digits, we expect each digit to occur 1,000 times. While
SymPy is capable of calculating many more digits of pi, our purpose here is to
set the stage for the much larger parallel calculation.</p>
<p>In this example, we use two functions from <tt class="file docutils literal"><span class="pre">pidigits.py</span></tt>:
<tt class="xref py py-func docutils literal"><span class="pre">one_digit_freqs()</span></tt> (which calculates how many times each digit occurs)
and <tt class="xref py py-func docutils literal"><span class="pre">plot_one_digit_freqs()</span></tt> (which uses Matplotlib to plot the result).
Here is an interactive IPython session that uses these functions with
SymPy:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [7]: </span><span class="kn">import</span> <span class="nn">sympy</span>

<span class="gp">In [8]: </span><span class="n">pi</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">pi</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>

<span class="gp">In [9]: </span><span class="n">pi</span>
<span class="gr">Out[9]: </span><span class="mf">3.141592653589793238462643383279502884197</span>

<span class="gp">In [10]: </span><span class="n">pi</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">pi</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">digits</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">pi</span><span class="p">)[</span><span class="mi">2</span><span class="p">:])</span>  <span class="c"># create a sequence of digits</span>

<span class="gp">In [12]: </span><span class="n">run</span> <span class="n">pidigits</span><span class="o">.</span><span class="n">py</span>  <span class="c"># load one_digit_freqs/plot_one_digit_freqs</span>

<span class="gp">In [13]: </span><span class="n">freqs</span> <span class="o">=</span> <span class="n">one_digit_freqs</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span>

<span class="gp">In [14]: </span><span class="n">plot_one_digit_freqs</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>
<span class="gr">Out[14]: </span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x18a55290</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting plot of the single digit counts shows that each digit occurs
approximately 1,000 times, but that with only 10,000 digits the
statistical fluctuations are still rather large:</p>
<img alt="../_images/single_digits.png" src="../_images/single_digits.png" />
<p>It is clear that to reduce the relative fluctuations in the counts, we need
to look at many more digits of pi. That brings us to the parallel calculation.</p>
</div>
<div class="section" id="parallel-calculation">
<h3>Parallel calculation<a class="headerlink" href="#parallel-calculation" title="Permalink to this headline">¶</a></h3>
<p>Calculating many digits of pi is a challenging computational problem in itself.
Because we want to focus on the distribution of digits in this example, we
will use pre-computed digit of pi from the website of Professor Yasumasa
Kanada at the University of Tokyo (<a class="reference external" href="http://www.super-computing.org">http://www.super-computing.org</a>). These
digits come in a set of text files (<a class="reference external" href="ftp://pi.super-computing.org/.2/pi200m/">ftp://pi.super-computing.org/.2/pi200m/</a>)
that each have 10 million digits of pi.</p>
<p>For the parallel calculation, we have copied these files to the local hard
drives of the compute nodes. A total of 15 of these files will be used, for a
total of 150 million digits of pi. To make things a little more interesting we
will calculate the frequencies of all 2 digits sequences (00-99) and then plot
the result using a 2D matrix in Matplotlib.</p>
<p>The overall idea of the calculation is simple: each IPython engine will
compute the two digit counts for the digits in a single file. Then in a final
step the counts from each engine will be added up. To perform this
calculation, we will need two top-level functions from <tt class="file docutils literal"><span class="pre">pidigits.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">compute_two_digit_freqs</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read digits of pi from a file and compute the 2 digit frequencies.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">txt_file_to_digits</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">two_digit_freqs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">freqs</span>

<span class="k">def</span> <span class="nf">reduce_freqs</span><span class="p">(</span><span class="n">freqlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add up a list of freq counts to get the total counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">allfreqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">freqlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freqlist</span><span class="p">:</span>
        <span class="n">allfreqs</span> <span class="o">+=</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">allfreqs</span>
</pre></div>
</div>
<p>We will also use the <tt class="xref py py-func docutils literal"><span class="pre">plot_two_digit_freqs()</span></tt> function to plot the
results. The code to run this calculation in parallel is contained in
<tt class="file docutils literal"><span class="pre">docs/examples/newparallel/parallelpi.py</span></tt>. This code can be run in parallel
using IPython by following these steps:</p>
<ol class="arabic simple">
<li>Use <strong class="command">ipcluster</strong> to start 15 engines. We used an 8 core (2 quad
core CPUs) cluster with hyperthreading enabled which makes the 8 cores
looks like 16 (1 controller + 15 engines) in the OS. However, the maximum
speedup we can observe is still only 8x.</li>
<li>With the file <tt class="file docutils literal"><span class="pre">parallelpi.py</span></tt> in your current working directory, open
up IPython in pylab mode and type <tt class="docutils literal"><span class="pre">run</span> <span class="pre">parallelpi.py</span></tt>.  This will download
the pi files via ftp the first time you run it, if they are not
present in the Engines&#8217; working directory.</li>
</ol>
<p>When run on our 8 core cluster, we observe a speedup of 7.7x. This is slightly
less than linear scaling (8x) because the controller is also running on one of
the cores.</p>
<p>To emphasize the interactive nature of IPython, we now show how the
calculation can also be run by simply typing the commands from
<tt class="file docutils literal"><span class="pre">parallelpi.py</span></tt> interactively into IPython:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">IPython.parallel</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="c"># The Client allows us to use the engines interactively.</span>
<span class="c"># We simply pass Client the name of the cluster profile we</span>
<span class="c"># are using.</span>
<span class="gp">In [2]: </span><span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s">&#39;mycluster&#39;</span><span class="p">)</span>
<span class="gp">In [3]: </span><span class="n">view</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">load_balanced_view</span><span class="p">()</span>

<span class="gp">In [3]: </span><span class="n">c</span><span class="o">.</span><span class="n">ids</span>
<span class="gr">Out[3]: </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>

<span class="gp">In [4]: </span><span class="n">run</span> <span class="n">pidigits</span><span class="o">.</span><span class="n">py</span>

<span class="gp">In [5]: </span><span class="n">filestring</span> <span class="o">=</span> <span class="s">&#39;pi200m.ascii.</span><span class="si">%(i)02d</span><span class="s">of20&#39;</span>

<span class="c"># Create the list of files to process.</span>
<span class="gp">In [6]: </span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">filestring</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;i&#39;</span><span class="p">:</span><span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">)]</span>

<span class="gp">In [7]: </span><span class="n">files</span>
<span class="go">Out[7]:</span>
<span class="go">[&#39;pi200m.ascii.01of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.02of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.03of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.04of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.05of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.06of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.07of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.08of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.09of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.10of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.11of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.12of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.13of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.14of20&#39;,</span>
<span class="go"> &#39;pi200m.ascii.15of20&#39;]</span>

<span class="c"># download the data files if they don&#39;t already exist:</span>
<span class="gp">In [8]: </span><span class="n">v</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fetch_pi_file</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

<span class="c"># This is the parallel calculation using the Client.map method</span>
<span class="c"># which applies compute_two_digit_freqs to each file in files in parallel.</span>
<span class="gp">In [9]: </span><span class="n">freqs_all</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">compute_two_digit_freqs</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

<span class="c"># Add up the frequencies from each engine.</span>
<span class="gp">In [10]: </span><span class="n">freqs</span> <span class="o">=</span> <span class="n">reduce_freqs</span><span class="p">(</span><span class="n">freqs_all</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">plot_two_digit_freqs</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>
<span class="gr">Out[11]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">AxesImage</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x18beb110</span><span class="o">&gt;</span>

<span class="gp">In [12]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;2 digit counts of 150m digits of pi&#39;</span><span class="p">)</span>
<span class="gr">Out[12]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">Text</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x18d1f9b0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The resulting plot generated by Matplotlib is shown below. The colors indicate
which two digit sequences are more (red) or less (blue) likely to occur in the
first 150 million digits of pi. We clearly see that the sequence &#8220;41&#8221; is
most likely and that &#8220;06&#8221; and &#8220;07&#8221; are least likely. Further analysis would
show that the relative size of the statistical fluctuations have decreased
compared to the 10,000 digit calculation.</p>
<img alt="../_images/two_digit_counts.png" src="../_images/two_digit_counts.png" />
</div>
</div>
<div class="section" id="parallel-options-pricing">
<h2>Parallel options pricing<a class="headerlink" href="#parallel-options-pricing" title="Permalink to this headline">¶</a></h2>
<p>An option is a financial contract that gives the buyer of the contract the
right to buy (a &#8220;call&#8221;) or sell (a &#8220;put&#8221;) a secondary asset (a stock for
example) at a particular date in the future (the expiration date) for a
pre-agreed upon price (the strike price). For this right, the buyer pays the
seller a premium (the option price). There are a wide variety of flavors of
options (American, European, Asian, etc.) that are useful for different
purposes: hedging against risk, speculation, etc.</p>
<p>Much of modern finance is driven by the need to price these contracts
accurately based on what is known about the properties (such as volatility) of
the underlying asset. One method of pricing options is to use a Monte Carlo
simulation of the underlying asset price. In this example we use this approach
to price both European and Asian (path dependent) options for various strike
prices and volatilities.</p>
<p>The code for this example can be found in the <tt class="file docutils literal"><span class="pre">docs/examples/newparallel</span></tt>
directory of the IPython source. The function <tt class="xref py py-func docutils literal"><span class="pre">price_options()</span></tt> in
<tt class="file docutils literal"><span class="pre">mcpricer.py</span></tt> implements the basic Monte Carlo pricing algorithm using
the NumPy package and is shown here:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">price_options</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">260</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Price European and Asian options using a Monte Carlo method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    S : float</span>
<span class="sd">        The initial price of the stock.</span>
<span class="sd">    K : float</span>
<span class="sd">        The strike price of the option.</span>
<span class="sd">    sigma : float</span>
<span class="sd">        The volatility of the stock.</span>
<span class="sd">    r : float</span>
<span class="sd">        The risk free interest rate.</span>
<span class="sd">    days : int</span>
<span class="sd">        The number of days until the option expires.</span>
<span class="sd">    paths : int</span>
<span class="sd">        The number of Monte Carlo paths used to price the option.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A tuple of (E. call, E. put, A. call, A. put) option prices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span><span class="n">sqrt</span>
    
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">days</span>
    <span class="n">const1</span> <span class="o">=</span> <span class="n">exp</span><span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
    <span class="n">const2</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">stock_price</span> <span class="o">=</span> <span class="n">S</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">stock_price_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">):</span>
        <span class="n">growth_factor</span> <span class="o">=</span> <span class="n">const1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">const2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">paths</span><span class="p">))</span>
        <span class="n">stock_price</span> <span class="o">=</span> <span class="n">stock_price</span><span class="o">*</span><span class="n">growth_factor</span>
        <span class="n">stock_price_sum</span> <span class="o">=</span> <span class="n">stock_price_sum</span> <span class="o">+</span> <span class="n">stock_price</span>
    <span class="n">stock_price_avg</span> <span class="o">=</span> <span class="n">stock_price_sum</span><span class="o">/</span><span class="n">days</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">r_factor</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">days</span><span class="p">)</span>
    <span class="n">euro_put</span> <span class="o">=</span> <span class="n">r_factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="n">K</span><span class="o">-</span><span class="n">stock_price</span><span class="p">))</span>
    <span class="n">asian_put</span> <span class="o">=</span> <span class="n">r_factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="n">K</span><span class="o">-</span><span class="n">stock_price_avg</span><span class="p">))</span>
    <span class="n">euro_call</span> <span class="o">=</span> <span class="n">r_factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="n">stock_price</span><span class="o">-</span><span class="n">K</span><span class="p">))</span>
    <span class="n">asian_call</span> <span class="o">=</span> <span class="n">r_factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="n">stock_price_avg</span><span class="o">-</span><span class="n">K</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">euro_call</span><span class="p">,</span> <span class="n">euro_put</span><span class="p">,</span> <span class="n">asian_call</span><span class="p">,</span> <span class="n">asian_put</span><span class="p">)</span>
</pre></div>
</div>
<p>To run this code in parallel, we will use IPython&#8217;s <tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt> class,
which distributes work to the engines using dynamic load balancing. This
view is a wrapper of the <tt class="xref py py-class docutils literal"><span class="pre">Client</span></tt> class shown in
the previous example. The parallel calculation using <tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt> can
be found in the file <tt class="file docutils literal"><span class="pre">mcpricer.py</span></tt>. The code in this file creates a
<tt class="xref py py-class docutils literal"><span class="pre">TaskClient</span></tt> instance and then submits a set of tasks using
<tt class="xref py py-meth docutils literal"><span class="pre">TaskClient.run()</span></tt> that calculate the option prices for different
volatilities and strike prices. The results are then plotted as a 2D contour
plot using Matplotlib.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;Run a Monte-Carlo options pricer in parallel.&quot;&quot;&quot;</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Imports</span>
<span class="c">#-----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">IPython.parallel</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mcpricer</span> <span class="kn">import</span> <span class="n">price_options</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Setup parameters for the run</span>
<span class="c">#-----------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">ask_question</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">the_type</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> [</span><span class="si">%r</span><span class="s">]: &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">the_type</span><span class="p">(</span><span class="n">default</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">the_type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">the_type</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>

<span class="n">cluster_profile</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Cluster profile&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;default&quot;</span><span class="p">)</span>
<span class="n">price</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Initial price&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Interest rate&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Days to expiration&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Number of MC paths&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">n_strikes</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Number of strike values&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">min_strike</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Min strike price&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">)</span>
<span class="n">max_strike</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Max strike price&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mf">110.0</span><span class="p">)</span>
<span class="n">n_sigmas</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Number of volatility values&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">min_sigma</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Min volatility&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">max_sigma</span> <span class="o">=</span> <span class="n">ask_question</span><span class="p">(</span><span class="s">&quot;Max volatility&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>

<span class="n">strike_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_strike</span><span class="p">,</span> <span class="n">max_strike</span><span class="p">,</span> <span class="n">n_strikes</span><span class="p">)</span>
<span class="n">sigma_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_sigma</span><span class="p">,</span> <span class="n">max_sigma</span><span class="p">,</span> <span class="n">n_sigmas</span><span class="p">)</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Setup for parallel calculation</span>
<span class="c">#-----------------------------------------------------------------------------</span>

<span class="c"># The Client is used to setup the calculation and works with all</span>
<span class="c"># engines.</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">cluster_profile</span><span class="p">)</span>

<span class="c"># A LoadBalancedView is an interface to the engines that provides dynamic load </span>
<span class="c"># balancing at the expense of not knowing which engine will execute the code.</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">load_balanced_view</span><span class="p">()</span>

<span class="c"># Initialize the common code on the engines. This Python module has the</span>
<span class="c"># price_options function that prices the options.</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Perform parallel calculation</span>
<span class="c">#-----------------------------------------------------------------------------</span>

<span class="k">print</span> <span class="s">&quot;Running parallel calculation over strike prices and volatilities...&quot;</span>
<span class="k">print</span> <span class="s">&quot;Strike prices: &quot;</span><span class="p">,</span> <span class="n">strike_vals</span>
<span class="k">print</span> <span class="s">&quot;Volatilities: &quot;</span><span class="p">,</span> <span class="n">sigma_vals</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c"># Submit tasks to the TaskClient for each (strike, sigma) pair as a MapTask.</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">async_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strike_vals</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">sigma</span> <span class="ow">in</span> <span class="n">sigma_vals</span><span class="p">:</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">price_options</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">strike</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
        <span class="n">async_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Submitted tasks: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">async_results</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c"># Block until all tasks are completed.</span>
<span class="n">c</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">async_results</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t2</span><span class="o">-</span><span class="n">t1</span>

<span class="k">print</span> <span class="s">&quot;Parallel calculation completed, time = </span><span class="si">%s</span><span class="s"> s&quot;</span> <span class="o">%</span> <span class="n">t</span>
<span class="k">print</span> <span class="s">&quot;Collecting results...&quot;</span>

<span class="c"># Get the results using TaskClient.get_task_result.</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">ar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">async_results</span><span class="p">]</span>

<span class="c"># Assemble the result into a structured NumPy array.</span>
<span class="n">prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_strikes</span><span class="o">*</span><span class="n">n_sigmas</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;ecall&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s">&#39;eput&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s">&#39;acall&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s">&#39;aput&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">)]</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">price</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    
<span class="n">prices</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_strikes</span><span class="p">,</span> <span class="n">n_sigmas</span><span class="p">)</span>
<span class="n">strike_mesh</span><span class="p">,</span> <span class="n">sigma_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">strike_vals</span><span class="p">,</span> <span class="n">sigma_vals</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Results are available: strike_mesh, sigma_mesh, prices&quot;</span>
<span class="k">print</span> <span class="s">&quot;To plot results type &#39;plot_options(sigma_mesh, strike_mesh, prices)&#39;&quot;</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Utilities</span>
<span class="c">#-----------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">plot_options</span><span class="p">(</span><span class="n">sigma_mesh</span><span class="p">,</span> <span class="n">strike_mesh</span><span class="p">,</span> <span class="n">prices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a contour plot of the option price in (sigma, strike) space.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">sigma_mesh</span><span class="p">,</span> <span class="n">strike_mesh</span><span class="p">,</span> <span class="n">prices</span><span class="p">[</span><span class="s">&#39;ecall&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;European Call&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Strike Price&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">sigma_mesh</span><span class="p">,</span> <span class="n">strike_mesh</span><span class="p">,</span> <span class="n">prices</span><span class="p">[</span><span class="s">&#39;acall&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Asian Call&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">sigma_mesh</span><span class="p">,</span> <span class="n">strike_mesh</span><span class="p">,</span> <span class="n">prices</span><span class="p">[</span><span class="s">&#39;eput&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;European Put&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Volatility&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Strike Price&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">sigma_mesh</span><span class="p">,</span> <span class="n">strike_mesh</span><span class="p">,</span> <span class="n">prices</span><span class="p">[</span><span class="s">&#39;aput&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Asian Put&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Volatility&quot;</span><span class="p">)</span>



    
</pre></div>
</div>
<p>To use this code, start an IPython cluster using <strong class="command">ipcluster</strong>, open
IPython in the pylab mode with the file <tt class="file docutils literal"><span class="pre">mcdriver.py</span></tt> in your current
working directory and then type:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [7]: </span><span class="n">run</span> <span class="n">mcdriver</span><span class="o">.</span><span class="n">py</span>
<span class="go">Submitted tasks:  [0, 1, 2, ...]</span>
</pre></div>
</div>
<p>Once all the tasks have finished, the results can be plotted using the
<tt class="xref py py-func docutils literal"><span class="pre">plot_options()</span></tt> function. Here we make contour plots of the Asian
call and Asian put options as function of the volatility and strike price:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [8]: </span><span class="n">plot_options</span><span class="p">(</span><span class="n">sigma_vals</span><span class="p">,</span> <span class="n">K_vals</span><span class="p">,</span> <span class="n">prices</span><span class="p">[</span><span class="s">&#39;acall&#39;</span><span class="p">])</span>

<span class="gp">In [9]: </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gr">Out[9]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x18c178d0</span><span class="o">&gt;</span>

<span class="gp">In [10]: </span><span class="n">plot_options</span><span class="p">(</span><span class="n">sigma_vals</span><span class="p">,</span> <span class="n">K_vals</span><span class="p">,</span> <span class="n">prices</span><span class="p">[</span><span class="s">&#39;aput&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>These results are shown in the two figures below. On a 8 core cluster the
entire calculation (10 strike prices, 10 volatilities, 100,000 paths for each)
took 30 seconds in parallel, giving a speedup of 7.7x, which is comparable
to the speedup observed in our previous example.</p>
<img alt="../_images/asian_call.png" src="../_images/asian_call.png" />
<img alt="../_images/asian_put.png" src="../_images/asian_put.png" />
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>To conclude these examples, we summarize the key features of IPython&#8217;s
parallel architecture that have been demonstrated:</p>
<ul class="simple">
<li>Serial code can be parallelized often with only a few extra lines of code.
We have used the <tt class="xref py py-class docutils literal"><span class="pre">DirectView</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt> classes
for this purpose.</li>
<li>The resulting parallel code can be run without ever leaving the IPython&#8217;s
interactive shell.</li>
<li>Any data computed in parallel can be explored interactively through
visualization or further numerical calculations.</li>
<li>We have run these examples on a cluster running Windows HPC Server 2008.
IPython&#8217;s built in support for the Windows HPC job scheduler makes it
easy to get started with IPython&#8217;s parallel capabilities.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The newparallel code has never been run on Windows HPC Server, so the last
conclusion is untested.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dag_dependencies.html" title="DAG Dependencies"
             >next</a> |</li>
        <li class="right" >
          <a href="parallel_winhpc.html" title="Getting started with Windows HPC Server 2008"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
       <li><a href="../index.html">documentation </a> &raquo;</li>

          <li><a href="index.html" >Using IPython for parallel computing</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008, The IPython Development Team.
      Last updated on Jul 31, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
  </body>
</html>