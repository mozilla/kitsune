{% macro search_box(settings, id=False, prefix=None, target=None,
                    placeholder=_('Find help...'),
                    params=None) %}
  <form data-instant-search="form" {% if id %}id="{{ id }}"{% endif %} action="{{ url('search') }}" method="get" {% if target %} target="{{ target }}"{% endif %} class="simple-search-form">
    {% if params %}
      {% for k, v in params.items() %}
        <input type="hidden" name="{{ k }}" value="{{ v }}" />
      {% endfor %}
    {% endif %}
    <input type="search" autocomplete="off" name="q" aria-required="true" placeholder="{{ placeholder }}" class="searchbox" id="search-q" />
    <button type="submit" title="{{ _('Search') }}" class="search-button">{{ _('Search') }}</button>
  </form>
{% endmacro %}

{% macro aux_nav(user, hide_aaq_link=False) %}
  {% if not settings.READ_ONLY %}
    {% if not hide_aaq_link %}
      {% if request.LANGUAGE_CODE in AAQ_LANGUAGES %}
        {% set ask_url = url('questions.aaq_step1') %}
      {% else %}
        {% set ask_url = url('wiki.document', 'get-community-support') %}
      {% endif %}
    {% endif %}
  {% endif %}
  <li class="mzp-c-menu-category mzp-has-drop-down mzp-js-expandable">
    <a class="mzp-c-menu-title sumo-nav--link" href="{{ url('questions.home') }}" aria-haspopup="true" aria-controls="mzp-c-menu-panel-help">Get Help</a>
    <div class="mzp-c-menu-panel mzp-has-card" id="mzp-c-menu-panel-help">
      <div class="sumo-nav--dropdown-container">
        <div class="sumo-nav--dropdown-grid">
          <button class="mzp-c-menu-button-close" type="button" aria-controls="mzp-c-menu-panel-example">Close Firefox menu</button>
          <div class="sumo-nav--dropdown-col">
            <section class="mzp-c-menu-item mzp-has-icon sumo-nav--dropdown-item">
              <a class="mzp-c-menu-item-link" href="{{ ask_url }}">
                <svg class="mzp-c-menu-item-icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M11 3H4a2 2 0 00-2 2v12a2 2 0 002 2h9l2 4 2-4h2a2 2 0 002-2v-6"/><path d="M17.5 2.5a2.121 2.121 0 013 3L13 13l-4 1 1-4 7.5-7.5z"/></g></svg>
                <h4 class="mzp-c-menu-item-title">Ask the Community</h4>
                <p class="mzp-c-menu-item-desc">
                  Create a thread and find answers in any of our product support forums.
                </p>
              </a>
              <ul class="mzp-c-menu-item-list sumo-nav--sublist">
                <li><a href="/questions/new/desktop">Firefox Browser</a></li>
                <li><a href="/questions/new/firefox-private-network">Firefox Private Network</a></li>
                <li><a href="/questions/new/ios">Firefox for iOS</a></li>
                <li><a href="/questions/new/firefox-lockwise">Firefox Lockwise</a></li>
                <li><a href="/questions/new/mobile">Firefox for Android</a></li>
                <li><a class="color-link" href="{{ url('questions.home') }}">See All Products</a></li>
              </ul>
            </section>
           </div>
           <div class="sumo-nav--dropdown-col">
             <section class="mzp-c-menu-item mzp-has-icon sumo-nav--dropdown-item">
               <a class="mzp-c-menu-item-link" href="/products">
                 <svg class="mzp-c-menu-item-icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g transform="translate(3 3)" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round"><rect stroke-linejoin="round" width="18" height="18" rx="2"/><path d="M4 5h10M4 9h10M4 13h4"/></g></svg>
                 <h4 class="mzp-c-menu-item-title">Explore Our Help Articles</h4>
                 <p class="mzp-c-menu-item-desc">
                   Dig into the knowledge base, tips and tricks, troubleshooting, and so much more.
                 </p>
               </a>
               <ul class="mzp-c-menu-item-list sumo-nav--sublist">
                 <li><a href="/products/firefox">Firefox Browser</a></li>
                 <li><a href="/products/firefox-private-network">Firefox Private Network</a></li>
                 <li><a href="/products/ios">Firefox for iOS</a></li>
                 <li><a href="/products/firefox-lockwise">Firefox Lockwise</a></li>
                 <li><a href="/products/mobile">Firefox for Android</a></li>
                 <li><a class="color-link" href="/products">See All Articles</a></li>
               </ul>
             </section>
            </div>
        </div>
      </div>
    </div>
  </li>
  {% if user.is_authenticated() %}
  <li class="mzp-c-menu-category mzp-has-drop-down mzp-js-expandable">
    <a class="mzp-c-menu-title sumo-nav--link" href="{{ url('landings.get_involved') }}" aria-haspopup="true" aria-controls="mzp-c-menu-panel-tools" data-event-category="navigation" data-event-action="main navigation" data-event-label="Contributor Tools">{{ _('Contributor Tools') }}</a>
    <div class="mzp-c-menu-panel mzp-has-card" id="mzp-c-menu-panel-tools">
      <div class="sumo-nav--dropdown-container">
        <div class="sumo-nav--dropdown-grid">
          <button class="mzp-c-menu-button-close" type="button" aria-controls="mzp-c-menu-panel-example">Close Firefox menu</button>
          <div class="sumo-nav--dropdown-col">
            <section class="mzp-c-menu-item mzp-has-icon sumo-nav--dropdown-item">
              <a class="mzp-c-menu-item-link" href="https://voice.mozilla.org/">
                <svg class="mzp-c-menu-item-icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M17 17l-1.051 3.154a1 1 0 01-1.898 0L13 17H5a2 2 0 01-2-2V5a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2h-2zM7 8h10M7 12h10"/></g></svg>
                <h4 class="mzp-c-menu-item-title">Discussions</h4>
                <p class="mzp-c-menu-item-desc">
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod.
                </p>
              </a>
              <ul class="mzp-c-menu-item-list sumo-nav--sublist">
                {{ _discussion_nav_links(user, default_language, active) }}
              </ul>
            </section>
           </div>
           <div class="sumo-nav--dropdown-col">
             <section class="mzp-c-menu-item mzp-has-icon sumo-nav--dropdown-item">
               <a class="mzp-c-menu-item-link" href="https://voice.mozilla.org/">
                 <svg class="mzp-c-menu-item-icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.5 9.5L3 17c-1 1.667-1 3 0 4s2.333.833 4-.5l7.5-7.5c2.333 1.054 4.333.734 6-.96 1.667-1.693 1.833-3.707.5-6.04l-3 3-2.5-.5L15 6l3-3c-2.333-1.333-4.333-1.167-6 .5-1.667 1.667-2.167 3.667-1.5 6z" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/></svg>
                 <h4 class="mzp-c-menu-item-title">Tools</h4>
                 <p class="mzp-c-menu-item-desc">
                   Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod.
                 </p>
               </a>
               <ul class="mzp-c-menu-item-list sumo-nav--sublist">
                 {{ _tools_nav_links(user, default_language, active) }}
               </ul>
             </section>
            </div>
        </div>
      </div>
    </div>
  </li>
  {% endif %}

  <li class="mzp-c-menu-category">
    <a class="mzp-c-menu-title sumo-nav--link" href="{{ url('landings.get_involved') }}">Volunteer</a>
  </li>
{% endmacro %}


{% macro profile_nav(user, hide_aaq_link=False) %}
{% if not hide_header_search %}
<li class="mzp-c-menu-category sumo-nav--item-right">
  {{ search_box(settings, id='support-search', params=search_params) }}
</li>
{% endif %}

<li class="mzp-c-menu-category {% if user.is_authenticated() %}mzp-has-drop-down mzp-js-expandable{% else %}logged-out-button-row{% endif %} {% if hide_locale_switcher %}sumo-nav--item-right{% endif %}">
  {% if show_header_fx_download() %}
    {# show-fx-download.js will remove the 'hidden' class below if the visitor is *NOT* using Firefox #}
    <a href="https://www.mozilla.org/firefox/new/?utm_source=support.mozilla.org&amp;utm_medium=referral&amp;utm_campaign=non-fx-button&amp;utm_content=header-download-button" class="firefox-download-button hidden sumo-button primary-button button-lg" data-event-category="Download Button" data-event-action="Firefox for Desktop">{{ _('Download Firefox') }}</a>
  {% endif %}
  {% if user.is_authenticated() %}
  <a class="mzp-c-menu-title sumo-nav--link has-avatar hide-on-mobile" href="{{ url('users.auth') }}">
    <span class="sumo-nav--username">{{ display_name(user) }}</span>
    {% if user.is_authenticated() %}
    <img class="avatar" src="{{ profile_avatar(user) }}" alt="Avatar for Username">
    {% else %}
    <img class="avatar" src="{{ STATIC_URL }}sumo/img/default-FFA-avatar.png" alt="Avatar for Username">
    {% endif %}
  </a>
  <div class="mzp-c-menu-panel mzp-has-card" id="mzp-c-menu-panel-profile">
    <div class="sumo-nav--dropdown-container">
      <div class="sumo-nav--dropdown-grid">
        <button class="mzp-c-menu-button-close" type="button" aria-controls="mzp-c-menu-panel-profile">Close Firefox menu</button>
        <div class="sumo-nav--dropdown-thirds">
          <section class="mzp-c-menu-item mzp-has-icon sumo-nav--dropdown-item">
            <a class="mzp-c-menu-item-link" href="{{ profile_url(user) }}">
              <svg class="mzp-c-menu-item-icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M17 17l-1.051 3.154a1 1 0 01-1.898 0L13 17H5a2 2 0 01-2-2V5a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2h-2zM7 8h10M7 12h10"/></g></svg>
              <h4 class="mzp-c-menu-item-title">Profile</h4>
              <p class="mzp-c-menu-item-desc">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod.
              </p>
            </a>
            <ul class="mzp-c-menu-item-list sumo-nav--sublist">
              <li><a href="{{ url('users.edit_my_profile') }}">{{ _('Edit Profile') }}</a></li>
              <li><a href="{{ url('questions.home') }}">My Questions</a></li>
            </ul>
          </section>
         </div>
         <div class="sumo-nav--dropdown-thirds">
           <section class="mzp-c-menu-item mzp-has-icon sumo-nav--dropdown-item">
             <a class="mzp-c-menu-item-link" href="{{ url('users.edit_settings') }}">
               <svg class="mzp-c-menu-item-icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.5 9.5L3 17c-1 1.667-1 3 0 4s2.333.833 4-.5l7.5-7.5c2.333 1.054 4.333.734 6-.96 1.667-1.693 1.833-3.707.5-6.04l-3 3-2.5-.5L15 6l3-3c-2.333-1.333-4.333-1.167-6 .5-1.667 1.667-2.167 3.667-1.5 6z" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/></svg>
               <h4 class="mzp-c-menu-item-title">Settings</h4>
               <p class="mzp-c-menu-item-desc">
                 Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod.
               </p>
             </a>
           </section>
          </div>
          <div class="sumo-nav--dropdown-thirds">
            <section class="mzp-c-menu-item mzp-has-icon sumo-nav--dropdown-item">
              <a class="mzp-c-menu-item-link" href="https://voice.mozilla.org/">
                <svg class="mzp-c-menu-item-icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.5 9.5L3 17c-1 1.667-1 3 0 4s2.333.833 4-.5l7.5-7.5c2.333 1.054 4.333.734 6-.96 1.667-1.693 1.833-3.707.5-6.04l-3 3-2.5-.5L15 6l3-3c-2.333-1.333-4.333-1.167-6 .5-1.667 1.667-2.167 3.667-1.5 6z" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <h4 class="mzp-c-menu-item-title">Inbox</h4>
                <p class="mzp-c-menu-item-desc">
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod.
                </p>
              </a>
            </section>
            <div class="sumo-button-wrap align-end">
              <form id="sign-out" action="{{ url('users.logout') }}" method="post">
                {% csrf_token %}
              </form>
              <a
                class="sumo-button secondary-button button-lg"
                data-type="submit"
                data-form="sign-out"
                href="#sign-out"
                data-event-label="Sign Out">
                {{ _('Sign Out') }}
              </a>
           </div>
        </div>
      </div>
    </div>
  </div>
  {% else %}
    <a href="{{ url('users.auth') }}" class="sumo-button secondary-button button-lg" data-event-category="navigation" data-event-action="main navigation" data-event-label="Sign In">{{ _('Sign In/Up') }}</a>
  {% endif %}
</li>
{% endmacro %}

{% macro content_editor(field) %}
  <div class="field has-large-textarea editor{% if field.errors %} invalid{% endif %}" data-media-search-url="{{ url('gallery.async') }}" data-media-gallery-url="{{ url('gallery.home') }}">
    <div class="editor-tools"></div>
    <div>{{ field|safe }}</div>
  </div>
  <div class="field" style="display: none;">
    <select id="_languages-select-box">
      {% for lang in settings.LANGUAGE_CHOICES %}
        <option value="{{ lang[0] }}" {% if lang[0] == request.LANGUAGE_CODE %}selected="selected"{% endif %}>{{ lang[1] }} ({{ lang[0] }})</option>
      {% endfor %}
    </select>
  </div>
{% endmacro %}



{% macro list_view_item(url, label, class=None, icon_url=None) %}
<li>
  <a href="{{ url }}"{% if class %} class="{{ class }}"{% endif %}>
    {% if icon_url %}
      <img class="icon" src="{{ icon_url }}" />
    {% endif %}
    {{ label }}
  </a>
</li>
{% endmacro %}

{% macro for_contributors_sidebar(user, default_language, li_only=False, active=None) -%}
  {% if user.is_authenticated() %}
  <nav class="sidebar-nav" id="for-contributors-sidebar">
    <span class="details-heading"></span>
    {% if not li_only %}
      <ul class="sidebar-nav--list">
    {% endif %}
      <li class="sidebar-subheading sidebar-nav--heading-item">{{ _('For Contributors') }}</li>
      {{ _discussion_nav_links(user, default_language, active) }}
      {{ _tools_nav_links(user, default_language, active) }}

    {% if not li_only %}
      </ul>
    {% endif %}
  </nav>
  {% endif %}
{%- endmacro %}

{% macro _discussion_nav_links(user, default_language, active=None) -%}
<li><a href="{{ url('community.home') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Community Hub">{{ _('Community Discussions') }}</a></li>
<li><a href="{{ url('questions.home') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Support Forum Home">{{ _('Support Forum') }}</a></li>
<li><a href="{{ url('dashboards.aggregated_metrics') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Localization Metrics">{{ _('L10N Discussions') }}</a></li>
<li><a href="#">(Needs URL) Social Support Forum</a></li>
<li><a href="{{ url('wiki.locale_discussions') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Article Discussions">{{ _('Article Discussions') }}</a></li>
<li><a href="#">(Needs URL) New Contributors</a></li>
{% if user.has_perm('flagit.can_moderate') %}
  <li><a href="{{ url('flagit.queue') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Moderate Forum Content">{{ _('Moderate Forum Content') }}</a></li>
{% endif %}
{% endmacro %}

{% macro _tools_nav_links(user, default_language, active=None) -%}
<li><a href="{{ url('search.advanced') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Advanced Search">{{ _('Advanced Search') }}</a></li>
<li><a href="/kb/category/60" data-event-category="navigation" data-event-action="main navigation" data-event-label="Templates">{{ _('Templates') }}</a></li>
<li><a href="{{ url('dashboards.localization') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Dashboards">{{ _('Dashboards') }}</a></li>
<li><a href="{{ url('wiki.revisions') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Recent Revisions">{{ _('Recent Revisions') }}</a></li>
<li><a href="{{ url('gallery.home') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Media Gallery">{{ _('Media Gallery') }}</a></li>
<!-- <li><a href="#">Tag Admin</a></li> -->

<li><a href="{{ url('landings.get_involved') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Quickstart Guide">(remove?) {{ _('Quickstart Guide') }}</a></li>
<li><a href="{{ url('wiki.document', 'contributor-news-resources') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="News &amp; Resources">(remove?) {{ _('News &amp; Resources') }}</a></li>
<li><a href="{{ url('forums.forums') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Contributor Forums">(remove?) {{ _('Contributor Forums') }}</a></li>
<li><a href="{{ url('questions.metrics') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="Support Forum Metrics">(remove?) {{ _('Support Forum Metrics') }}</a></li>
<li><a href="{{ url('kpi.dashboard') }}" data-event-category="navigation" data-event-action="main navigation" data-event-label="KPI Dashboard">(remove?) {{ _('KPI Dashboard') }}</a></li>
{% endmacro %}

{# This is designed to be used like this:
  {% call announcement_bar('foo', 'info') %}
    This is the contents of the bar.
  {% endcall %}
#}
{% macro announcement_bar(id, level) -%}
  <div id="announce-{{ id }}" class="mzp-c-notification-bar mzp-t-{{ level }}">
    <button class="mzp-c-notification-bar-button close-button" data-close-id="announce-{{ id }}" type="button"></button>
    <p>{{ caller() }}</p>
  </div>
{% endmacro %}

{% macro favicon() %}
  <link rel="apple-touch-icon" sizes="180x180" href="{{ STATIC_URL }}sumo/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ STATIC_URL }}sumo/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ STATIC_URL }}sumo/img/favicon-16x16.png">
  <link rel="manifest" href="{{ STATIC_URL }}sumo/manifest.json">
  <link rel="shortcut icon" href="{{ STATIC_URL }}sumo/img/favicon.ico">
  <meta name="msapplication-config" content="{{ STATIC_URL }}sumo/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
{% endmacro %}

{% macro download_firefox() %}
{# show-fx-download.js will remove the 'hidden' class below if the visitor is *NOT* using Firefox #}
<div class="firefox-download-button hidden">
  <div class="download-buttons">
    <div class="download-firefox">
      <a href="https://www.mozilla.org/firefox/new/?utm_source=support.mozilla.org&amp;utm_medium=referral&amp;utm_campaign=non-fx-button&amp;utm_content=body-download-button"
        class="download-button sumo-button primary-button button-lg"
        data-event-category="Download Button"
        data-event-action="Panel Opening"
        data-event-label="{{ latest_version }}">
        {{ _('Download Firefox') }}
      </a>
      <ul class="download-firefox--info text-body-xs">
        <li><a href="https://www.mozilla.org/firefox/all/">{{ _('Systems and Languages') }}</a></li>
        <li><a href="https://www.mozilla.org/firefox/notes">{{ _("What's New") }}</a></li>
        <li><a href="https://www.mozilla.org/legal/privacy/firefox">{{ _('Privacy') }}</a></li>
      </ul>
    </div>
    {#
      afaict, this button is never shown. products.js is looking for a
      data-latest-version attribute on the .download-button element above,
      but it's not present. this should be fixed?
    #}
    <div class="refresh-firefox">
      <p class="help-text">{{ _('Give Firefox a tune up') }}</p>
      <a data-mozilla-ui-reset="reset" class="download-button sumo-button primary-button button-lg">
        {{ _('Refresh Firefox') }}
      </a>
      <ul class="download-firefox--info text-body-xs">
        <li><a class="reset-link" href="{{ url('wiki.document', 'refresh-firefox-reset-add-ons-and-settings') }}">
          {{ _('How does it work?') }}
        </a></li>
        <li>
          <a href="https://www.mozilla.org/firefox/new/#download-fx"
            data-event-category="Download Button"
            data-event-action="Panel Opening"
            data-event-label="{{ latest_version }}">
            {{ _('Download a fresh copy') }}
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>
{% endmacro %}

{% macro field(field=None, extra_classes=None) %}
<div class="field{% if extra_classes %} {{ extra_classes }}{% endif %}{% if field.errors %} has-error{% endif %}">

  <label for="{{ field.id_for_label }}">{{ field.label }}</label>

  {{ field }} {# Entire input field is generated by Django #}

  {% if field.errors %}
    {% for error in field.errors %}
    <span class="form-error is-visible">{{ error|safe }}</span>
    {% endfor %}
  {% endif %}

  {% if field.help_text %}
    <p class="help-text">{{ field.help_text|safe }}</p>
  {% endif %}
</div>
{% endmacro %}

{% macro checkbox(field=None, extra_classes=None) %}
<div class="field checkbox{% if extra_classes %} {{ extra_classes }}{% endif %}{% if field.errors %} has-error{% endif %}">
  {{ field }} {# Entire input field is generated by Django #}
  <label for="{{ field.id_for_label }}">{{ field.label }}</label>

  {% if field.errors %}
    {% for error in field.errors %}
    <span class="form-error is-visible">{{ error|safe }}</span>
    {% endfor %}
  {% endif %}

  {% if field.help_text %}
    <p class="help-text">{{ field.help_text|safe }}</p>
  {% endif %}
</div>
{% endmacro %}
