{% extends "community/base.html" %}

{% block content %}
  <h1 class="main-heading">{{ _('Community Hub') }}</h1>

  <article class="contributors">
    <h1>{{ _('Top Contributors') }}</h1>

    {# TODO: comment out for now
    <div class="selector block">
      <button type="button" class="ts-select-trigger">
        <!-- arrow icon using icon font -->
        <span aria-hidden="true" data-icon-arrow="&#xe800;" class="selector-arrow">
            <span class='current-selected'>{{ _('Select Top Contributors by Locale') }}</span>
        </span>
      </button>
      <div class="select-options ts-modal" aria-expanded="false">
        <ul class="ts-options" tabindex="-1">
            <li><a href="#en-US" class="selected" aria-checked="true">{{ _('English') }}</a></li>
            <li><a href="#fr">{{ _('French') }}</a></li>
            <li><a href="#de">{{ _('German') }}</a></li>
        </ul>
      </div>
    </div>
    #}

    <section class="contributor-group">
      <h2>{{ _('Support Forum') }}</h2>
      {{ render_contributors(top_contributors_questions, 'questions') }}
    </section>

    <section class="contributor-group">
      <h2>{{ _('Knowledge Base') }}</h2>
      {{ render_contributors(top_contributors_kb, 'kb') }}
    </section>

    <section class="contributor-group">
      <h2>{{ _('Localization') }}</h2>
      {{ render_contributors(top_contributors_l10n, 'l10n') }}
    </section>

    <section class="contributor-group">
      <h2>{{ _('Army of Awesome') }}</h2>
      {{ render_contributors(top_contributors_aoa, 'army-of-awesome') }}
  </article>

  <article class="community-news">
    <section>
      <h1>{{ _('Find your fellow contributors') }}</h1>

      <form name="find-contributor" id="find-contributor" action="{{ url('community.search') }}" method="get">

        {# COMMENT THIS OUT FOR NOW
        <input type="hidden" value="" id="ts-value" name="findby" />

        <div class="selector" data-emulate-select="true">
          <button type="button" class="ts-select-trigger">
            <!-- arrow icon using icon font -->
            <span aria-hidden="true" data-icon-arrow="&#xe800;" class="selector-arrow">
                <span class='currently-selected'>{{ _('Find By') }}</span>
            </span>
          </button>
          <div class="select-options ts-modal" aria-expanded="false">
            <ul class="ts-options" tabindex="-1">
              <li><a href="javascript:void(0);" data-value="username">{{ _('Username') }}</a></li>
              <li><a href="javascript:void(0);" data-value="display_name">{{ _('Display Name') }}</a></li>
            </ul>
          </div>
        </div>
        ENDCOMMENT #}

        <fieldset>
          <input type="text" name="q" id="search" placeholder="{{ _('Username or Display Name') }}" />
          <input type="submit" value="{{ _('Search') }}" class="search" />
        </fieldset>
      </form>
    </section>


    {% if community_news %}
      <section id="doc-content">
        {{ community_news.html|safe }}
      </section>
    {% endif %}

  </article>
{% endblock %}

{% macro render_contributors(results, area) -%}
  <ul class="contributor-list {{ area }}">
    {% for result in results %}
      <li>
        {% set tooltip = _('{user} - {num} contributions in last 90 days')|f(user=display_name(result['user']), num=result['count']) %}
        <a href="{{ url('users.profile', result['user'].id) }}" title="{{ tooltip }}">
          <img src="{{ profile_avatar(result['user'], size=60) }}" width="60" height="60" alt="{{ tooltip }}" />
        </a>
      </li>
    {% endfor %}
  </ul>
  <p>
    <a href="{{ url('community.top_contributors', area=area) }}" class="view-all">
      {{ _('See All') }}
    </a>
  </p>
{%- endmacro %}
