{% extends "base.html" %}
{% from 'products/includes/topic_macros.html' import topic_sidebar, topic_tabs %}
{% from 'includes/common_macros.html' import download_firefox %}
{% set crumbs = [(url('products.product', slug=product.slug), pgettext('DB: products.Product.title', product.title))] %}
{% if subtopic %}
  {% set crumbs = crumbs + [(url('products.documents', product_slug=product.slug, topic_slug=topic.slug), pgettext('DB: products.Topic.title', topic.title)), (None, pgettext('DB: products.Topic.title', subtopic.title))] %}
  {% set canonical_url = canonicalize(model_url=subtopic.get_absolute_url()) %}
{% else %}
  {% set crumbs = crumbs + [(None, pgettext('DB: products.Topic.title', topic.title))] %}
  {% set canonical_url = canonicalize(model_url=topic.get_absolute_url()) %}
{% endif %}
{% set styles = ('products',) %}
{% set search_params = {'product': product.slug} %}

{% block title %}{{ pgettext('DB: products.Topic.title', topic.title) }} | {{ _('{product} Help')|f(product=pgettext('DB: products.Product.title', product.title)) }}{% endblock %}

{% block above_main %}
{% endblock %}

{% block columns_modifier %}sidebar-on-right{% endblock %}

{% block side %}
<div class="search-form-large">
  {{ search_box(settings, id='support-search-documents', params=search_params) }}
</div>

{{ topic_sidebar(topics[:10], subtopics, product, topic, subtopic) }}
{% endblock %}


{% block content %}
<div class="documents-product-title">
  {% set prod_url = url('products.product', slug=product.slug) %}
  <a href="{{ prod_url }}"><img src="{{ product.image_alternate_url }}" height="48" width="48" alt="" /></a>
</div>


    <article id="document-list">
      <header class="sumo-article-header">
        <div class="sumo-article-header--text">
          <h1 class="text-display-lg topic-title">
            {% if subtopic %}
              <a href="{{ url('products.documents', product_slug=product.slug, topic_slug=topic.slug) }}">
            {% endif %}
            {{ pgettext('DB: products.Topic.title', topic.title) }}
            {% if subtopic %}
              </a>
            {% endif %}
          </h1>

        {% if subtopic %}
          <h1 class="topic-title is-subtopic cf">
            {{ pgettext('DB: products.Topic.title', subtopic.title) }}
          </h1>
        {% endif %}

        {# Show the description if it is different than the title. Otherwise, don't bother. #}
        {% if (subtopic and subtopic.title != subtopic.description) or (not subtopic and topic.title != topic.description) %}
          <p class="topic-description color-heading text-body-lg">
            {% if subtopic %}
               {{ pgettext('DB: products.Topic.description', subtopic.description) }}
            {% else %}
              {{ pgettext('DB: products.Topic.description', topic.description) }}
            {% endif %}
          </p>
        {% endif %}
        </div>
        {% if product.slug == 'firefox' %}
        <div class="sumo-article-header--meta">
          {{ download_firefox() }}
        </div>
        {% endif %}
      </header>

      {{ topic_tabs(topics[:10], subtopics, product, topic, subtopic) }}




      <section class="topic-list">
        {% if not subtopic and subtopics %}
          {# only show subtopics on the parent topic page #}
          {% for subtopic in subtopics %}
            <article class="topic-article subtopic">
              <h2 class="text-display-xxs">
                <a href="{{ url('products.subtopics', product_slug=product.slug, topic_slug=topic.slug, subtopic_slug=subtopic.slug) }}"
                  data-event-category="link click" data-event-action="subtopic" data-event-label="{{ subtopic.title }}">
                  {{ pgettext('DB: products.Topic.title', subtopic.title) }}
                </a>
              </h2>
              {% if subtopic.title != subtopic.description %}
              <p>{{ pgettext('DB: products.Topic.description', subtopic.description) }}</p>
              {% endif %}
            </article>
          {% endfor %}
        {% endif %}
        {% for document in documents %}
          <article class="topic-article">
            <h2 class="text-display-xxs">
              <a href="{{ document['url'] }}" data-event-category="link click" data-event-action="document"
                data-event-label="{{ document['document_title'] }}">
                {{ document['document_title'] }}
              </a>
            </h2>
            <p>{{ document['document_summary'] }}</p>
          </article>
        {% endfor %}
      </section>

      {% if fallback_documents %}
        <h2 class="text-display-xs">{{ _('In English') }}</h2>
        <section class="topic-list">
        {% for document in fallback_documents %}
          <article>
            <h3 class="text-display-xxs">
              <a href="{{ document['url']|replace('/'+ settings.WIKI_DEFAULT_LANGUAGE +'/', '/' + request.LANGUAGE_CODE + '/') }}">
                {{ document['document_title'] }}
              </a>
            </h3>
          </article>
        {% endfor %}
        </section>
      {% endif %}
    </article>
{% endblock %}

{% block below_main %}
<section id="get-involved-button" class="mzp-l-content sumo-page-section">
  <div class="sumo-button-wrap align-center document-get-involved">
    <a class="sumo-button primary-button button-lg" href="{{ url('landings.get_involved') }}">{{ _('Volunteer for Mozilla Support') }}</a>
  </div>
</section>
{% endblock %}

{% block for_contributors %}{% endblock %}
