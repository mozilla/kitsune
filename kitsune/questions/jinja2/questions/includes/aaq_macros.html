{% macro aaq_progress(step=0) -%}
  {% set percent = step * 33.3 %}
  {% set steps = (
      _('Pick a product'),
      _('Pick a topic and try some solutions'),
      _('Fill in details')
    )
  %}
  <div id="aaq_progress" class="cf">
    <div class="progress-bar{% if percent == 100 %} complete{% endif %}">
      <div style="width: {{ percent }}%;"></div>
      <ul class="legend mzp-u-list-styled">
        {% for step_name in steps %}
          <li {% if steps.index(step_name) == step %}class="current"{% endif %}><span>{{ step_name }}</span></li>
        {% endfor %}
      </ul>
    </div>
  </div>
{%- endmacro  %}

{% macro select_product(products) -%}
  <h1 class="sumo-page-heading">{{ _('Ask the Community') }}</h1>
  <h2 class="sumo-page-subheading">{{ _('Which product do you need help with?') }}</h2>
  <div class="sumo-page-section--inner">
    <div id="product-picker" class="sumo-card-grid stack-on-mobile" style="--cg-count: {{ products|length }};">
      <div class="scroll-wrap">
        {% for key, product in products.iteritems() %}
        <div class="card card--product zoom-on-hover">
          {% if key == 'other' %}
          <img src="{{ static('sumo/img/mozilla-icon.png') }}"
              alt="{{ _(product.name) }}"
              class="card--icon">
          {% else %}
          <img src="{{ image_for_product(product.product) }}"
              alt="{{ pgettext('DB: products.Product.title', product.title) }}"
              class="card--icon">
          {% endif %}

          <div class="card--details">
            <h3 class="card--title">
              <a class="expand-this-link title"
                href="{{ url('questions.aaq_step2', product_key=key) }}"
                data-event-category="link click"
                data-event-action="product"
                data-event-label="{{ product.name }}">
                {{ product.name }}
              </a>
            </h3>
            <p class="card--desc">{{ product.subtitle }}</p>
          </div>
        </div>
        {% endfor %}
        <div class="card card--centered-button">
          <a class="sumo-button primary-button button-lg" href="{{ url('questions.home') }}">{{ _('See All Product Forums')}}</a>
        </div>
      </div>
    </div>
  </div>
{%- endmacro %}

{% macro selected_product(product, can_change) -%}
  <div id="selected-product">
    <br />
    <p>{{ _('Product') }}: <strong><span>{{ product.name }}</span></strong>
    {% if can_change %}
      <a class="text-body-sm"
         href="{{ url('questions.aaq_step1') }}{% if is_mobile_device %}?q=change_product{% endif %}">
         {{ _('change product') }}
       </a>
    {% endif %}
    </p>
  </div>
{%- endmacro %}

{% macro progress_bar(product, final=alse) %}
{# `if not current_product` is how you isolate step 1. `if form` isolates step 3 #}
  <ul class="progress">
    <li class="progress--item {% if final %}is-complete{% elif not current_product %}is-current{% else %}is-complete{% endif %}">
      <a class="progress--link"
        {% if current_product %}
          href="{{ url('questions.aaq_step1') }}"
        {% else %}
          href="#" disabled
        {% endif %}>
        <span class="progress--link-inner">
          <span class="progress--dot"></span>
          <span class="progress--label">Select Product</span>
        </span>
      </a>
    </li>
    <li class="progress--item {% if form or final %}is-complete{% elif current_product %}is-current{% endif %}">
      <a class="progress--link" href="#TODO" disabled>
        <span class="progress--link-inner">
          <span class="progress--dot"></span>
          <span class="progress--label">Explore Solutions</span>
        </span>
      </a>
    </li>
    <li class="progress--item {% if final %}is-complete{% elif form %}is-current{% endif %}">
      <a class="progress--link" href="#" disabled>
        <span class="progress--link-inner">
          <span class="progress--dot"></span>
          <span class="progress--label">Create Question</span>
        </span>
      </a>
    </li>
  </ul>
{%- endmacro %}

{% macro select_category(product, search_box) -%}
<section class="sumo-page-section question-masthead shade-bg">
  <div class="mzp-l-content">

    {{ progress_bar(product) }}

    <div class="sumo-l-two-col sidebar-on-right align-center cols-on-medium">
      <div class="sumo-l-two-col--main">
        <img class="page-heading--logo" src="{{ product.image }}" alt="{{ product.name }} logo #TODO">
        <h1 class="sumo-page-heading ">
          <span class="product-title-text">{{ product.name }} {{ _('Solutions') }}</span>
        </h1>
        {{ search_box(settings, id='question-search-masthead', params=search_params) }}

        <p class="page-heading--intro-text">
            {{ _('Search your question or keywords to find solutions in the knowledge base or forums') }}
        </p>
      </div>
      <div class="sumo-l-two-col--sidebar">
        <div class="card elevation-01 text-center radius-md">
          <h2 class="card--title has-bottom-margin">{{ _('Ask the Community') }}</h2>
          <p>{{ _('Sign in/up to post your question and get help.') }}</p>
          <a class="sumo-button primary-button feature-box" href="#TODO">Ask a Question</a>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="wrap" id="main-content">
<section class="mzp-l-content sumo-page-section--inner">
  <div class="text-center-to-left-on-large">
    <h2 class="sumo-page-subheading">{{ _('Popular Articles') }}</h2>
  </div>
  {% include "landings/includes/featured_articles.html" %}
</section>
<section class="sumo-page-section--inner hide-when-search-is-active highlight-box">
    <div class="mzp-l-content">
      <div class="sumo-page-subheader">
        <div class="sumo-page-subheader--text">
          <h2 class="sumo-page-subheading">{{ _('Popular Topics') }}</h2>
        </div>
      </div>
      <div class="sumo-card-grid" style="--cg-count: {{ category|length }};">
        <div class="scroll-wrap">
          {% for key, category in product.categories.iteritems() %}
          {% set category_url = url('questions.aaq_step3', product_key=product.key, category_key=key) %}
          <div class="card card--topic">
            <img
              class="card--icon"
              src="{{ category.image }}"
              alt="{{ category.name }} icon"
            />
            <div class="card--details">
              <h3 class="card--title">
                <a class="expand-this-link"
                  href="{{ category_url }}"
                  data-on-hover="{{ _('See all') }}"
                  data-event-category="link click"
                  data-event-action="topic"
                  data-event-label="{{ category.name }}"
                  >
                  {{ category.name }}
                </a>
              </h3>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
</section>
</div>
{%- endmacro %}

{% macro selected_category(category, product, can_change) -%}
  <div id="selected-category">
    <p>{{ _('Category') }}: <strong><span>{{ category.name }}</span></strong>
    {% if can_change %}
      <a class="text-body-sm" href="{{ url('questions.aaq_step2', product_key=product.key) }}">{{ _('change category') }}</a>
    {% endif %}
    </p>
  </div>
{%- endmacro %}

{% macro current_articles_and_message(articles, category, html=None, all_articles=False) -%}
  <div class="highlight-box" id="try-an-article">
    {% if html %}
      <h2 class="sumo-page-subheading">{{ html|safe }}</h2>
    {% else %}
      <h2 class="sumo-page-subheading">{{ _('Try one of these articles:') }}</h2>
    {% endif %}
    {% if articles %}
      <ul class="topic-list">
        {% if not all_articles %}
          {% set articles = articles[:5] %}
        {% endif %}
        {% for article in articles %}
          <li>
            <a class="sumo-page-intro" href="{{ article.url }}" target="_blank"><strong>{{ article.document_title }}</strong></a>
            <p>{{ article.document_summary }}</p>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
{%- endmacro %}

{% macro aaq_search_form(product, category, settings, host, request, has_searched=False) -%}
<div class="sumo-page-section">
  <form id="ask-search-form" class="simple-search-form {% if has_searched %}has-searched{% endif %} cf" action="#summarize-question" method="get">
    <div class="field is-condensed full-width">
      <label for="id_ask_a_question">{{ _("Can't find an answer? Summarize your question in a sentence.") }}</label>
      <input id="id_ask_a_question"type="text" class="searchbox" name="search" value="{{ request.GET.search }}" required="required" maxlength="160" />
    </div>
    <div class="sumo-button-wrap">
      <button data-type="submit" class="sumo-button primary-button">{{ _('Ask this') }}</button><br>
    </div>
  </form>
</div>
{%- endmacro %}

{% macro show_results(search_results, product, category, request) -%}
  {% if search_results %}
    <div class="highlight-box">
      <ul class="select-one search-results">
        {% for result in search_results %}
          <li>
            <a href="{{ result['url'] }}">{{ result['title'] }}</a>
            <p>
              {{ result['excerpt_html']|safe }}
            </p>
          </li>
        {% endfor %}
      </ul>
    </div>
    {% set button_text = _('None of these solve my problem') %}
  {% else %}
    <h2 class="no-results">{{ _('This question has not been asked before.') }}</h2>
    {% set button_text = _('Provide more details') %}
  {% endif %}

  <form action="{{ url('questions.aaq_step5', product_key=product.key, category_key=category.key) }}" method="get">
    <input type="hidden" name="search" value="{{ request.GET.search }}" />
    <input type="hidden" name="step" value="{% if user.is_authenticated() %}aaq-question{% else %}aaq-register{% endif %}" />
    <input type="submit" id="show-form-btn" class="sumo-button primary-button" value="{{ button_text }}" />
  </form>
{%- endmacro %}

{% macro marketplace_category(category_slug, form, error_message) -%}
  {% if category_slug == 'payments' %}
    <h2 class="sumo-page-subheading">
      {% trans %}
        Please visit the
        <a href="https://www.paypal.com/cgi-bin/helpweb?cmd=_help">
          Paypal Help Center</a>.
      {% endtrans %}
    </h2>
  {% elif category_slug == 'applications' %}
    <h2 class="sumo-page-subheading">
      {% trans %}
        Please visit the Marketplace page for the application. There
        you can find the developers' contact information and contact them
        directly.
      {% endtrans %}
    </h2>
  {% elif category_slug == 'account' or category_slug == 'refund' or category_slug == 'developer-request' %}
    {% if error_message %}
      <ul class="errorlist">
        <li>{{ error_message }}</li>
      </ul>
    {% endif %}
    <form id="question-form" class="marketplace" action="" method="post">
      {% csrf_token %}
      <ol>
        {{ form.as_ul() }}
        <li class="submit sumo-button-wrap">
          <button type="submit" class="sumo-button primary-button">{{ _('Submit Issue') }}</button>
        </li>
      </ol>
    </form>
  {% endif %}
{%- endmacro %}


{% macro troubleshooting_instructions(field) %}
  <div>
    <div id="api-section">
      <div class="sumo-button-wrap">
        <a href="#" class="sumo-button" id="share-data">
          {{ _('Share Data') }}
        </a>

        <a href="#troubleshooting-field" class="sumo-button link-button expander">{{ _('Show info') }} »</a>
      </div>
      <p>{% trans %}
          This information gives details about the internal workings of your
          browser that will help in answering your question. A window will
          open in the top corner. Click Allow, and then click Install. If the
          automated way doesn't work, <a href="#">try these manual steps</a>.
         {% endtrans %}
       </p>
    </div>

    <div id="troubleshooting-field" class="hide-until-expanded field full-width">
      {{ field }}
    </div>
  </div>
{% endmacro %}
